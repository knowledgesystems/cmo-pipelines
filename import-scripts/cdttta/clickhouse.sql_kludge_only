INSERT INTO sample_profile (sample_id, genetic_profile_id, panel_id) WITH missing_samples AS ( SELECT sample_id, cs.cancer_study_identifier AS cancer_study_identifier, CONCAT(cancer_study_identifier, '_mutations') as stable_id FROM sample_list_list sll JOIN sample_list sl ON sl.list_id = sll.list_id JOIN cancer_study cs ON cs.cancer_study_id = sl.cancer_study_id WHERE sl.stable_id LIKE '%_sequenced' AND CONCAT(sll.sample_id,'-',cs.cancer_study_id) NOT IN ( SELECT CONCAT(sp.sample_id,'-',cs.cancer_study_id) FROM sample_profile sp JOIN genetic_profile gp ON gp.genetic_profile_id = sp.genetic_profile_id JOIN cancer_study cs ON cs.cancer_study_id = gp.cancer_study_id WHERE gp.genetic_alteration_type = 'MUTATION_EXTENDED')) SELECT ms.sample_id as sample_id, gp.genetic_profile_id AS genetic_profile_id, NULL AS panel_id FROM missing_samples ms JOIN genetic_profile gp ON ms.stable_id = gp.stable_id JOIN cancer_study cs ON cs.cancer_study_id = gp.cancer_study_id;
