57,64c57,70
<     sample_unique_id         String,
<     sample_unique_id_base64  String,
<     sample_stable_id         String,
<     patient_unique_id        String,
<     patient_unique_id_base64 String,
<     patient_stable_id        String,
<     cancer_study_identifier LowCardinality(String),
<     internal_id             Int
---
>     sample_unique_id            String,
>     sample_unique_id_base64     String,
>     sample_stable_id            String,
>     patient_unique_id           String,
>     patient_unique_id_base64    String,
>     patient_stable_id           String,
>     cancer_study_identifier     LowCardinality(String),
>     internal_id                 Int,
>     -- fields below are needed for the SUMMARY projection
>     patient_internal_id         Int,
>     sample_type                 String,
>     -- fields below are needed for the DETAILED projection
>     sequenced                   Int,
>     copy_number_segment_present Int
69a76,94
> WITH 
>     sequenced_samples AS (
>         SELECT
>             sample.stable_id
>         FROM sample_list_list
>                  INNER JOIN sample_list ON sample_list_list.list_id = sample_list.list_id
>                  INNER JOIN sample ON sample_list_list.sample_id = sample.internal_id
>                  INNER JOIN patient ON sample.patient_id = patient.internal_id
>                  INNER JOIN cancer_study ON patient.cancer_study_id = cancer_study.cancer_study_id
>         WHERE sample_list.stable_id = concat(cancer_study.cancer_study_identifier, '_sequenced')
>     ),
>     cn_segment_samples AS (
>         SELECT
>             concat(cancer_study.cancer_study_identifier, '_', sample.stable_id) as segment_unique_id
>         FROM copy_number_seg
>                  INNER JOIN cancer_study ON copy_number_seg.cancer_study_id = cancer_study.cancer_study_id
>                  INNER JOIN sample ON copy_number_seg.sample_id = sample.internal_id
>                  INNER JOIN patient ON sample.patient_id = patient.internal_id
>     )
77c102,108
<        sample.internal_id                                        AS internal_id
---
>        sample.internal_id                                        AS internal_id,
>        -- fields below are needed for the SUMMARY projection
>        sample.patient_id                                         AS patient_internal_id,
>        sample.sample_type                                        AS sample_type,
>        -- fields below are needed for the DETAILED projection
>        if (sample.stable_id IN sequenced_samples, 1, 0)          AS sequenced,
>        if (sample_unique_id IN cn_segment_samples, 1, 0)         AS copy_number_segment_present
